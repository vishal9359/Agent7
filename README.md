# Agent7: LLM-Assisted C++ Program Understanding Agent (Python Implementation)

A deterministic program understanding agent that generates accurate flowcharts and sequence diagrams from compiler-generated CFG and CallGraph JSON files.

**Implementation Language**: Python 3.x

## ğŸ¯ Objective

Generate accurate flowcharts and sequence diagrams from:
- **Deterministic CFG/CallGraph JSON** (from Clang)
- **Semantic Description JSON** (validated & corrected)

## ğŸ—ï¸ System Architecture

```
Clang
 â”œâ”€â”€ CFG / CallGraph JSON        â†’ direct input to LLM
 â””â”€â”€ Description JSON           â†’ validated â†’ stored in RAG

Agent
 â”œâ”€â”€ Uses CFG as single source of truth for execution
 â”œâ”€â”€ Uses Description JSON only for naming, labels, explanation
 â””â”€â”€ Outputs Mermaid diagrams
```

## ğŸš« Hard Rules (Non-Negotiable)

- âœ… Use CLANG library to build CFG (external tool)
- âŒ Never infer execution logic
- âŒ Never modify CFG or CallGraph
- âŒ Never use RAG for control flow
- âŒ Never add branches, loops, or calls not present in CFG
- âŒ If information is missing â†’ say "Not present in CFG"

Violating any rule is a critical failure.

## ğŸ§© Agent Modules

### Module 1: Primary Analysis Agent
- **Responsibilities**: Read CFG/CallGraph JSON and Description JSON, generate Mermaid diagrams
- **Behavior**: Treat CFG as execution truth, Description JSON as editable semantic metadata

### Module 2: Description Validation Agent
- **Input**: Raw Description JSON, CFG/CallGraph JSON
- **Output**: Validated or Corrected Description JSON
- **Validation Rules**:
  - âŒ Mentions conditions not in CFG
  - âŒ Mentions calls not in CallGraph
  - âŒ Claims behavior not supported by execution paths
  - âŒ Uses speculative language ("probably", "might", "seems")

### Module 3: Diagram Validation Agent
- **Input**: Mermaid diagram, CFG/CallGraph JSON
- **Output**: Validated or Corrected Mermaid
- **Validation Rules**:
  - âŒ Node count â‰  CFG nodes
  - âŒ Edge count â‰  CFG edges
  - âŒ Missing loop-back edges
  - âŒ Incorrect branch labels
  - âŒ Function calls missing or added

## ğŸ“‹ Execution Flow

1. Load CFG / CallGraph JSON
2. Load raw Description JSON
3. Run Description Validation Agent
   - If invalid â†’ correct â†’ overwrite Description JSON
4. Generate Mermaid diagram using:
   - CFG (structure)
   - Validated Description JSON (labels only)
5. Run Diagram Validation Agent
   - If invalid â†’ fix Mermaid
6. Output:
   - Final Mermaid
   - Short explanation

## ğŸš€ Installation

### Prerequisites

- Python 3.6 or higher
- No external dependencies required (uses only Python standard library)

### Setup

```bash
# Clone the repository
git clone https://github.com/vishal9359/Agent7.git
cd Agent7

# No installation required - just run the script
python agent.py --help
```

## ğŸ“– Usage

```bash
python agent.py <cfg_json_file> <description_json_file> [callgraph_json_file]
```

### Example

```bash
python agent.py example_cfg.json example_description.json example_callgraph.json
```

On Unix-like systems, you can make it executable:
```bash
chmod +x agent.py
./agent.py example_cfg.json example_description.json example_callgraph.json
```

### Example Files

- `example_cfg.json`: Sample CFG JSON structure
- `example_description.json`: Sample Description JSON
- `example_callgraph.json`: Sample CallGraph JSON

## ğŸ“„ Data Models

### CFG JSON (Read-Only)

```json
{
  "function": "Replicate",
  "nodes": [
    { "id": 1, "type": "entry" },
    { "id": 2, "type": "condition", "expr": "x > 0" },
    { "id": 3, "type": "call", "callee": "sendData" },
    { "id": 4, "type": "return" }
  ],
  "edges": [
    { "from": 1, "to": 2 },
    { "from": 2, "to": 3, "label": "true" },
    { "from": 2, "to": 4, "label": "false" }
  ]
}
```

### Description JSON (Editable)

```json
{
  "Replicate": {
    "summary": "Handles replication logic",
    "notes": "Uses sendData when condition is met",
    "validated": true,
    "issues": []
  }
}
```

### CallGraph JSON

```json
{
  "functions": {
    "Replicate": ["sendData"]
  }
}
```

## ğŸ–Šï¸ Mermaid Rules

- Use `flowchart TD` (Top-Down)
- Node IDs must match CFG node IDs exactly
- Condition labels must match CFG labels
- Loops must have explicit back edges
- No additional nodes or edges beyond CFG

## ğŸ“Š Output

The agent generates:
1. **Mermaid diagram** (saved to `output.mermaid`)
2. **Console output** with validation results
3. **Corrected Description JSON** (if validation fails)

## ğŸ›‘ Failure Conditions

The agent will abort or warn if:
- CFG is incomplete (no nodes)
- CallGraph missing (warning only)
- Description conflicts with CFG
- Diagram fails validation twice

## ğŸ”§ Integration with Clang

This agent expects CFG and CallGraph JSON to be generated by external Clang tools. Example workflow:

1. Use Clang's CFG extraction tools to generate `cfg.json`
2. Use Clang's CallGraph analysis to generate `callgraph.json`
3. Run `python agent.py` with these files
4. Get validated Mermaid diagrams

## ğŸ“ Notes

- The agent is deterministic and produces zero hallucination
- All diagrams strictly follow CFG structure
- Description JSON is validated and corrected if needed
- All validation issues are reported clearly

## ğŸ“„ License

See repository for license information.

